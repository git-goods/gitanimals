filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /logs/*.json
    json:
      keys_under_root: true
      add_error_key: true
      message_key: message
    multiline:
      pattern: '^{'
      negate: true
      match: after

processors:
  - script:
      when:
        has_fields: ['error.stack_trace']
      lang: javascript
      id: stacktrace_stringify
      source: >
        function process(event) {
          var trace = event.Get("error.stack_trace");
          if (Array.isArray(trace)) {
            event.Put("error.stack_trace", trace.join("\n"));
          } else if (typeof trace === "string") {
          } else {
            event.Delete("error.stack_trace");
          }
        }

output.elasticsearch:
  hosts: ["192.168.0.31:9200"]
  username: "${FILEBEAT_USERNAME}"
  password: "${FILEBEAT_PASSWORD}"
